(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c0ddf114"],{"01ea":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"role-manage"},[r("div",{staticClass:"button-group"},[r("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))]),r("el-button",{attrs:{type:"warning",size:"small",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("添加")])],1),r("div",{staticStyle:{"margin-bottom":"10px"}},[r("span",{staticStyle:{"font-size":"14px","font-weight":"normal"}},[e._v("所属系统：")]),r("el-select",{staticStyle:{"margin-left":"10px"},attrs:{placeholder:"请选择系统",size:"small"},on:{change:e.selectSystem},model:{value:e.currentSystem,callback:function(t){e.currentSystem=t},expression:"currentSystem"}},e._l(e.systemOptions,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.roleDataList,stripe:"",size:"mini"}},[r("el-table-column",{attrs:{prop:"role_name",label:"角色名"}}),r("el-table-column",{attrs:{prop:"remark",label:"备注"}}),r("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(r){return e.handleEdit(t.row)}}},[e._v("编辑")]),r("el-button",{staticClass:"btn-text-red",attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),r("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":10,layout:"total, prev, pager, next, jumper",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),r("el-dialog",{attrs:{title:e.handleTitle,visible:e.handleVisible,width:"30%",center:""},on:{"update:visible":function(t){e.handleVisible=t}}},[r("el-form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.rules,"status-icon":"","label-width":"90px",size:"small"}},[r("el-form-item",{attrs:{label:"角色名",prop:"role_name"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-input",{attrs:{maxlength:"50",type:"text"},model:{value:e.roleForm.role_name,callback:function(t){e.$set(e.roleForm,"role_name","string"===typeof t?t.trim():t)},expression:"roleForm.role_name"}})],1)],1)],1),r("el-form-item",{attrs:{label:"备注"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-input",{attrs:{maxlength:"100",type:"text"},model:{value:e.roleForm.remark,callback:function(t){e.$set(e.roleForm,"remark","string"===typeof t?t.trim():t)},expression:"roleForm.remark"}})],1)],1)],1),r("el-form-item",{attrs:{label:"菜单权限"}},[r("el-row",[r("el-col",{attrs:{span:24}},[e.handleVisible?r("div",{key:"roleTreeForm",staticClass:"tree-container"},[r("el-tree",{ref:"menuTree",staticClass:"tree-body",attrs:{"show-checkbox":"","default-expand-all":!0,data:e.roleMenuTree,"node-key":"id","default-checked-keys":e.roleTreeData,props:e.defaultProps}})],1):e._e()])],1)],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small",type:"primary",loading:e.tableLoading},on:{click:e.handleConfirm}},[e._v("确 定")]),r("el-button",{attrs:{size:"small",disabled:e.tableLoading},on:{click:function(t){e.handleVisible=!1}}},[e._v("取 消")])],1)],1)],1)},n=[],l=(r("5ab2"),r("e10e"),r("163d"),r("63ff"),r("57f0")),o=(r("6d57"),r("f548"),r("289c")),i=r("5880"),s=r("365c"),c=r("f753"),u=r.n(c);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){Object(o["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(e,t,r){e.currentName&&e.currentName===t?r():u()({method:"get",url:s["a"].checkRoleName,params:{roleName:t,appName:e.appName}}).then((function(e){e.data&&e.data.length>0?r(new Error("角色名已存在")):r()}))},p={data:function(){return{handleTitle:"",handleVisible:!1,delVisible:!1,tableLoading:!1,currentPage:1,totalCount:10,pageSize:10,currentSystem:"",systemOptions:[],defaultProps:{children:"children",label:"text"},roleTreeData:[],roleForm:{role_name:"",remark:"",menu_ids:[]},rules:{role_name:[{validator:h,trigger:"blur"},{required:!0,message:"请输入姓名",trigger:"blur"}]}}},computed:d({},Object(i["mapState"])({roleMenuTree:function(e){return e.authority.roleMenuTree},roleDataList:function(e){return e.authority.roleDataList}})),mounted:function(){},methods:d({},Object(i["mapActions"])("authority",["getRoleList","getRoleMenuTree","addRole","editRole","removeRole"]),{resetForm:function(){this.roleForm={role_name:"",remark:"",menu_ids:[]}},getData:function(){var e=this;e.getRoleList(e)},handleSizeChange:function(e){this.pageSize=e,this.getData()},handleCurrentChange:function(e){this.currentPage=e,this.getData()},handleAdd:function(){this.resetForm(),this.roleTreeData=[],this.handleTitle="添加角色",this.rules.role_name[0].appName=this.currentSystem,this.handleVisible=!0,this.$refs.roleForm.clearValidate()},handleEdit:function(e){var t=this,r=this;r.roleForm={role_id:e.role_id,role_name:e.role_name,remark:e.remark,menu_ids:e.menu_ids},r.handleTitle="修改角色",this.rules.role_name[0].appName=this.currentSystem,this.rules.role_name[0].currentName=e.role_name,this.roleTreeData=[];var a=s["a"].getRoleMenu.replace("{roleId}",e.role_id);r.$axios({method:"get",url:a}).then((function(e){var a=[];e.data.forEach((function(e){if(-1!==e){var t=e+"";a.push(t)}})),t.roleTreeData=a,r.handleVisible=!0,r.$nextTick((function(){r.$refs.roleForm.clearValidate()}))}))},handleDelete:function(e){var t=this;this.roleForm.role_id=e.role_id,this.$confirm("删除不可恢复，是否确定删除?","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((function(){t.removeRole(t),t.delVisible=!1})).catch((function(){t.$message.info("取消删除")}))},handleConfirm:function(){var e=this,t=this;t.$refs.roleForm.validate(function(){var r=Object(l["a"])(regeneratorRuntime.mark((function r(a){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a){r.next=11;break}if(t.roleForm.app_name=t.currentSystem,t.tableLoading=!0,t.roleForm.menu_ids=e.$refs.menuTree.getCheckedKeys().concat(e.$refs.menuTree.getHalfCheckedKeys()).map(Number),"添加角色"!==t.handleTitle){r.next=7;break}return r.next=7,t.addRole(t);case 7:if("修改角色"!==t.handleTitle){r.next=10;break}return r.next=10,t.editRole(t);case 10:t.handleVisible=!1;case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},selectSystem:function(e){this.currentSystem=e,this.getData(),this.getRoleMenuTree(this)}})},f=p,b=(r("2d05"),r("5511")),g=Object(b["a"])(f,a,n,!1,null,"71284372",null);t["default"]=g.exports},"2d05":function(e,t,r){"use strict";var a=r("b86a"),n=r.n(a);n.a},b86a:function(e,t,r){}}]);