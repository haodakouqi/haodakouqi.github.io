webpackJsonp([4],{VOab:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("2ZGO"),a=o("P4ji"),r={name:"detail",data:function(){return{userName:sessionStorage.getItem("ms_username"),url:"",sequence_id:"",poc_id:"",track_id:"",customer_name:"",product_line:"",project_name:"",tableData:[],tableDataAll:[],currentPage:1,total:0,pageSize:10,listLoading:!0,del_list:[],addVisible:!1,editVisible:!1,delVisible:!1,downloadLoading:!1,form:{track_id:"",track_time_ts:"",communication_content:"",communication_effect:"",communication_person:"",customer_participant:"",competitors:"",work_memos:"",instruction:""},rules:{communication_content:[{required:!0,message:"请输入交流内容",trigger:"blur"},{max:512,message:"长度不超过 512 个汉字",trigger:"blur"}],communication_effect:[{required:!0,message:"请输入交流效果",trigger:"blur"},{max:128,message:"长度不超过 128 个字符",trigger:"blur"}],communication_person:[{required:!0,message:"请输入公司主要交流人员",trigger:"blur"},{max:128,message:"长度不超过 128 个字符",trigger:"blur"}],customer_participant:[{required:!0,message:"请输入客户主要参与人员",trigger:"blur"},{max:128,message:"长度不超过 128 个字符",trigger:"blur"}],competitors:[{required:!0,message:"请输入本轮交流竞争对手情况",trigger:"blur"},{max:256,message:"长度不超过 256 个字符",trigger:"blur"}],work_memos:[{required:!0,message:"请输入后续工作备忘",trigger:"blur"},{max:256,message:"长度不超过 256 个字符",trigger:"blur"}]},idx:-1}},created:function(){this.getData(),this.getDataAll()},computed:{data:function(){return this.tableData}},methods:{handleCurrentChange:function(t){this.currentPage=t,this.getData()},getData:function(){var t=this;this.sequence_id=this.$route.params.sequence_id,this.customer_name=this.$route.params.customer_name,this.product_line=this.$route.params.product_line,this.project_name=this.$route.params.project_name,this.poc_id=this.$route.params.poc_id,this.listLoading=!0,this.$axios.get(a.a.getDataDt,{params:{poc_id:this.poc_id,page:this.currentPage,per_page:this.pageSize},headers:{"user-name":this.userName}}).then(function(e){var o=e.data.data;t.tableData=o,t.total=e.data.totalCount,t.listLoading=!1})},getDataAll:function(){var t=this;this.poc_id=this.$route.params.poc_id,this.$axios.get(a.a.getDataAllDt,{params:{poc_id:this.poc_id},headers:{"user-name":this.userName}}).then(function(e){var o=e.data.data;t.tableDataAll=o})},dateFormat:function(t,e){var o=t[e.property];return void 0==o?"":(o=new Date(Number(o)),Object(i.a)(o,"yyyy-MM-dd"))},resetForm:function(){this.form={track_time_ts:"",communication_content:"",communication_effect:"",communication_person:"",customer_participant:"",competitors:"",work_memos:"",instruction:""}},handleEdit:function(t,e){this.idx=t;var o=this.tableData[t];this.form={track_id:o.track_id,track_time_ts:o.track_time_ts,communication_content:o.communication_content,communication_effect:o.communication_effect,communication_person:o.communication_person,customer_participant:o.customer_participant,competitors:o.competitors,work_memos:o.work_memos,instruction:o.instruction},this.editVisible=!0},saveEdit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return t.$message.error("请正确填入信息"),!1;t.$axios({method:"post",url:a.a.saveEditDt,data:{poc_id:t.poc_id,track_id:t.form.track_id,track_time_ts:t.form.track_time_ts/1e3,communication_content:t.form.communication_content,communication_effect:t.form.communication_effect,communication_person:t.form.communication_person,customer_participant:t.form.customer_participant,competitors:t.form.competitors,work_memos:t.form.work_memos,instruction:t.form.instruction},headers:{"user-name":t.userName}}).then(function(e){t.$set(t.tableData,t.idx,t.form),t.editVisible=!1,t.$message.success("修改第 "+(t.idx+1)+" 行成功")})})},handleAdd:function(){this.resetForm(),this.addVisible=!0},saveAdd:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return t.$message.error("请正确填入信息"),!1;t.$axios({method:"post",url:a.a.saveAddDt,data:{poc_id:t.poc_id,track_time_ts:t.form.track_time_ts/1e3,communication_content:t.form.communication_content,communication_effect:t.form.communication_effect,communication_person:t.form.communication_person,customer_participant:t.form.customer_participant,competitors:t.form.competitors,work_memos:t.form.work_memos,instruction:t.form.instruction},headers:{"user-name":t.userName}}).then(function(e){t.tableData.unshift(t.form),t.addVisible=!1,t.$message.success("添加成功"),t.getData()})})},handleDelete:function(t,e){this.idx=t,this.delVisible=!0,this.track_id=e.track_id},deleteRow:function(){var t=this;this.$axios.delete(a.a.deleteDt+this.track_id,{headers:{"user-name":this.userName}}).then(function(e){t.tableData.splice(t.idx,1),t.$message.success("删除成功"),t.delVisible=!1})},handleDownload:function(){var t=this;console.log(this.tableDataAll),this.downloadLoading=!0,o.e(14).then(o.bind(null,"umYh")).then(function(e){var o=t.formatJson(["sequence_id","product_line","customer_name","project_name","track_time_ts","communication_content","communication_effect","communication_person","customer_participant","competitors","work_memos","instruction"],t.tableDataAll);e.export_json_to_excel({header:["序号","产品线","客户名称","项目名称","交流日期","交流内容","交流效果","公司主要交流人员","客户主要参与人员","本轮交流竞争对手情况","后续工作备忘","备注"],data:o,filename:"poc_detail"}),t.downloadLoading=!1})},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){if("track_time_ts"===t){var o=new Date(Number(e[t]));return Object(i.a)(o,"yyyy-MM-dd")}return"sequence_id"===t?e.poc.sequence_id:"product_line"===t?e.poc.product_line.param_value:"customer_name"===t?e.poc.customer_name:"project_name"===t?e.poc.project_name:e[t]})})}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"table"},[o("div",{staticClass:"crumbs"},[o("el-breadcrumb",{attrs:{separator:"/"}},[o("el-breadcrumb-item",[o("i",{staticClass:"el-icon-date"}),t._v(" 销售机会信息")]),t._v(" "),o("el-breadcrumb-item",[t._v("销售过程明细")])],1)],1),t._v(" "),o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[o("el-tag",{attrs:{size:"medium"}},[t._v("客户名称："+t._s(t.customer_name))]),t._v(" "),o("el-tag",{attrs:{size:"medium"}},[t._v("归属产品线："+t._s(t.product_line))]),t._v(" "),o("el-tag",{attrs:{size:"medium"}},[t._v("项目名称："+t._s(t.project_name))]),t._v(" "),o("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:t.handleAdd}},[t._v("添加\n            ")]),t._v(" "),o("el-button",{staticStyle:{float:"right","margin-right":"5px"},attrs:{type:"primary",icon:"el-icon-download",loading:t.downloadLoading},on:{click:t.handleDownload}},[t._v("下载\n            ")])],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.data,stripe:"",border:""}},[o("el-table-column",{attrs:{align:"center",prop:"track_time_ts",label:"交流日期",sortable:"",width:"150",formatter:t.dateFormat}}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"交流内容",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.communication_content.length<11?o("div",[t._v(t._s(e.row.communication_content)+"\n                    ")]):o("el-tooltip",{attrs:{placement:"bottom"}},[o("div",{staticClass:"more-text-width",attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.communication_content))]),t._v(" "),o("div",{staticClass:"more-text"},[t._v(t._s(e.row.communication_content))])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"communication_effect",label:"交流效果",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.communication_effect.length<11?o("div",[t._v(t._s(e.row.communication_effect))]):o("el-tooltip",{attrs:{placement:"bottom"}},[o("div",{staticClass:"more-text-width",attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.communication_effect))]),t._v(" "),o("div",{staticClass:"more-text"},[t._v(t._s(e.row.communication_effect))])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"公司主要交流人员",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[null==e.row.communication_person||e.row.communication_person.length<11?o("div",[t._v("\n                        "+t._s(e.row.communication_person)+"\n                    ")]):o("el-tooltip",{attrs:{placement:"bottom"}},[o("div",{staticClass:"more-text-width",attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.communication_person)+"\n                        ")]),t._v(" "),o("div",{staticClass:"more-text"},[t._v(t._s(e.row.communication_person))])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"客户主要参与人员",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.customer_participant.length<11?o("div",[t._v(t._s(e.row.customer_participant))]):o("el-tooltip",{attrs:{placement:"bottom"}},[o("div",{staticClass:"more-text-width",attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.customer_participant))]),t._v(" "),o("div",{staticClass:"more-text"},[t._v(t._s(e.row.customer_participant))])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"本轮交流竞争对手情况",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.competitors.length<11?o("div",[t._v(t._s(e.row.competitors))]):o("el-tooltip",{attrs:{placement:"bottom"}},[o("div",{staticClass:"more-text-width",attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.competitors))]),t._v(" "),o("div",{staticClass:"more-text"},[t._v(t._s(e.row.competitors))])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"后续工作备忘",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.work_memos.length<11?o("div",[t._v(t._s(e.row.work_memos))]):o("el-tooltip",{attrs:{placement:"bottom"}},[o("div",{staticClass:"more-text-width",attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.poc.work_memos))]),t._v(" "),o("div",{staticClass:"more-text"},[t._v(t._s(e.row.work_memos))])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"备注"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.instruction.length<11?o("div",[t._v(t._s(e.row.instruction))]):o("el-tooltip",{attrs:{placement:"bottom"}},[o("div",{staticClass:"more-text-width",attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.poc.instruction))]),t._v(" "),o("div",{staticClass:"more-text"},[t._v(t._s(e.row.instruction))])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"small"},on:{click:function(o){t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),o("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(o){t.handleDelete(e.$index,e.row)}}},[t._v("删除\n                    ")])]}}])})],1),t._v(" "),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{layout:"total,prev, pager, next","page-size":t.pageSize,total:t.total,"current-page":t.currentPage},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e}}})],1)],1),t._v(" "),o("el-dialog",{attrs:{title:"编辑",visible:t.editVisible,width:"40%",center:""},on:{"update:visible":function(e){t.editVisible=e}}},[o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"170px","status-icon":"",size:"mini"}},[o("el-form-item",{attrs:{label:"交流日期"}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择日期","value-format":"timestamp",format:"yyyy-MM-dd"},model:{value:t.form.track_time_ts,callback:function(e){t.$set(t.form,"track_time_ts",e)},expression:"form.track_time_ts"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"交流内容",prop:"communication_content"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入交流内容(长度不超过 512 个汉字)"},model:{value:t.form.communication_content,callback:function(e){t.$set(t.form,"communication_content",e)},expression:"form.communication_content"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"交流效果",prop:"communication_effect"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入交流效果(长度不超过 128 个字符)"},model:{value:t.form.communication_effect,callback:function(e){t.$set(t.form,"communication_effect",e)},expression:"form.communication_effect"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"公司主要交流人员",prop:"communication_person"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入公司主要交流人员(长度不超过 128 个字符)"},model:{value:t.form.communication_person,callback:function(e){t.$set(t.form,"communication_person",e)},expression:"form.communication_person"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"客户主要参与人员",prop:"customer_participant"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入客户主要参与人员(长度不超过 128 个字符)"},model:{value:t.form.customer_participant,callback:function(e){t.$set(t.form,"customer_participant",e)},expression:"form.customer_participant"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"本轮交流竞争对手情况",prop:"competitors"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入本轮交流竞争对手情况(长度不超过 256 个字符)"},model:{value:t.form.competitors,callback:function(e){t.$set(t.form,"competitors",e)},expression:"form.competitors"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"后续工作备忘",prop:"work_memos"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入后续工作备忘(长度不超过 256 个字符)"},model:{value:t.form.work_memos,callback:function(e){t.$set(t.form,"work_memos",e)},expression:"form.work_memos"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"备注",prop:"instruction"}},[o("el-input",{attrs:{type:"textarea"},model:{value:t.form.instruction,callback:function(e){t.$set(t.form,"instruction",e)},expression:"form.instruction"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{ref:"form",attrs:{type:"primary"},on:{click:t.saveEdit}},[t._v("确 定")]),t._v(" "),o("el-button",{on:{click:function(e){t.editVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),o("el-dialog",{attrs:{title:"添加",visible:t.addVisible,width:"40%",center:""},on:{"update:visible":function(e){t.addVisible=e}}},[o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"170px","status-icon":"",size:"mini"}},[o("el-form-item",{attrs:{label:"交流日期"}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择日期","value-format":"timestamp",format:"yyyy-MM-dd"},model:{value:t.form.track_time_ts,callback:function(e){t.$set(t.form,"track_time_ts",e)},expression:"form.track_time_ts"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"交流内容",prop:"communication_content"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入交流内容(长度不超过 512 个汉字)"},model:{value:t.form.communication_content,callback:function(e){t.$set(t.form,"communication_content",e)},expression:"form.communication_content"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"交流效果",prop:"communication_effect"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入交流效果(长度不超过 128 个字符)"},model:{value:t.form.communication_effect,callback:function(e){t.$set(t.form,"communication_effect",e)},expression:"form.communication_effect"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"公司主要交流人员",prop:"communication_person"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入公司主要交流人员(长度不超过 128 个字符)"},model:{value:t.form.communication_person,callback:function(e){t.$set(t.form,"communication_person",e)},expression:"form.communication_person"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"客户主要参与人员",prop:"customer_participant"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入客户主要参与人员(长度不超过 128 个字符)"},model:{value:t.form.customer_participant,callback:function(e){t.$set(t.form,"customer_participant",e)},expression:"form.customer_participant"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"本轮交流竞争对手情况",prop:"competitors"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入本轮交流竞争对手情况(长度不超过 256 个字符)"},model:{value:t.form.competitors,callback:function(e){t.$set(t.form,"competitors",e)},expression:"form.competitors"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"后续工作备忘",prop:"work_memos"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入后续工作备忘(长度不超过 256 个字符)"},model:{value:t.form.work_memos,callback:function(e){t.$set(t.form,"work_memos",e)},expression:"form.work_memos"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"备注",prop:"instruction"}},[o("el-input",{attrs:{type:"textarea"},model:{value:t.form.instruction,callback:function(e){t.$set(t.form,"instruction",e)},expression:"form.instruction"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{ref:"form",attrs:{type:"primary"},on:{click:t.saveAdd}},[t._v("确 定")]),t._v(" "),o("el-button",{on:{click:function(e){t.addVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),o("el-dialog",{attrs:{title:"提示",visible:t.delVisible,width:"300px",center:""},on:{"update:visible":function(e){t.delVisible=e}}},[o("div",{staticClass:"del-dialog-cnt"},[t._v("删除不可恢复，是否确定删除？")]),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:t.deleteRow}},[t._v("确 定")]),t._v(" "),o("el-button",{on:{click:function(e){t.delVisible=!1}}},[t._v("取 消")])],1)])],1)},staticRenderFns:[]};var s=o("C7Lr")(r,n,!1,function(t){o("mwsv")},"data-v-dee44c34",null);e.default=s.exports},mwsv:function(t,e){}});